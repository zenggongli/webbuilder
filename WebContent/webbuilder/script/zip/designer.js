var Ds={clipBoard:null,stopSetProp:false,stopRecChg:false,stopSync:false,ctrlKey:false,consoleTimer:null,keyCode:0,moduleSeled:true,isFolder:false,isInsert:false,consoleIdx:0,consoleRaws:[],isCut:false,copiedModule:null,id:1,at:function(){return moduleTab.getActiveTab()},getId:function(){return"ds_"+Ds.id++},objectTreeFields:["text","id","xwlMeta","xwlChildren","xwlParent","xwlXtype","xwlCategory","xwlWidth","xwlHeight","xwlMinWidth","xwlMinHeight","xwlMaxWidth","xwlMaxHeight","xwlPT","properties","events","custPEditors","custEEditors","custEPara"],moduleTreeFields:["text","orgText","iconCls","MODULE_ID","PARENT_ID","IS_HIDDEN","NEW_WIN","IS_FOLDER","CREATE_USER","CREATE_DATE","LAST_MODIFY_USER","LAST_MODIFY_DATE","ORDER_INDEX"],createTab:function(g,a,i,h){var b=moduleTab,c="t_"+a,f;if(Wb.get(c)){b.setActiveTab(c);if(h){h(Wb.get(c).objectTree,Wb.get(c))}return}function e(n){var p,l,k;n.eachChild(function(m){l=m.custPObjs;for(p in l){k=l[p];if(Ext.isObject(k)){k.destroy()}}l=m.custEObjs;for(p in l){k=l[p];if(Ext.isObject(k)){k.destroy()}}e(m)})}function d(l){var t=f.objectTree.selectObject,q=f.propertyGrid,o=f.eventGrid,m=q.store.sorters.items[0],k=q.view.el.dom.scrollTop,s=o.view.el.dom.scrollTop;q.setSource(t.get("properties"));q.store.sort(m.property,m.direction);if(!l.custPObjs){l.custPObjs=Ext.apply({},l.get("custPEditors"))}q.plugins[0].editors.map=l.custPObjs;q.view.el.dom.scrollTop=k;m=o.store.sorters.items[0];o.setSource(t.get("events"));o.store.sort(m.property,m.direction);if(!l.custEObjs){l.custEObjs=Ext.apply({},l.get("custEEditors"))}o.plugins[0].editors.map=l.custEObjs;o.view.el.dom.scrollTop=s}function j(l,k,m){var n=m.plugins[0].editors.map[k.record.get("name")];if(n&&n.field){n.field.allowChange=false;if(n.field.blockPost){return false}}return true}b.add({id:c,iconCls:i,title:Wb.ellipsis(g),orgTitle:g,closable:true,layout:"fit",xtype:"tabpanel",plugins:[{ptype:"tabscrollermenu"}],deferredRender:false,listeners:{tabchange:function(l,k,m){Ds.rsPos(1);Wb.recNav(k,m,backBtn)},beforetabchange:function(k,m,l){Ds.svPos(1);Ds.completeEdit();if(l&&l.commitChange){l.commitChange()}},render:function(k){f=k;if(k.title!==k.orgTitle){k.ellipsisTip=new Ext.tip.ToolTip({target:k.tab.btnWrap,html:g})}},activate:function(l){saveBtn.setDisabled(!l.isModified);if(!l.saveUrl){var k=l.getActiveTab();if(k.isScriptEdt){Ds.focusEdt(k.scriptEditor)}}},beforedestroy:function(k){e(k.objectTree.getRootNode())},destroy:function(k){k.items.each(function(l){Wb.closeNav(backBtn,forwardBtn,l)});Wb.closeNav(backBtn,forwardBtn,k);k.objectTree.store.destroyStore();Ds.setSaveBtn();if(k.ellipsisTip){Ext.destroy(k.ellipsisTip);k.ellipsisTip=null}},beforeclose:function(k){if(k.isModified){b.setActiveTab(k);Wb.choose(Wb.format(Str.saveConfirm,k.title.substring(1)),function(l){if(l=="yes"){Ds.saveModule(false,function(){k.close()})}else{if(l=="no"){k.isModified=false;k.close()}}});return false}}},items:[{title:"General",layout:"border",iconCls:"home_icon",listeners:{render:function(k){f.generalTab=k}},items:[{region:"west",split:true,border:false,xtype:"tabpanel",deferredRender:false,width:460,listeners:{beforetabchange:function(k){Ds.svPos();Ds.completeEdit()},tabchange:function(l,k,m){Ds.rsPos()},render:function(k){f.contentTab=k}},items:[{title:"Properties",iconCls:"property_icon",xtype:"propertygrid",nameColumnWidth:170,source:{},listeners:{render:function(k){f.propertyGrid=k;Ds.dropUrl(k)},validateedit:function(l,k){return j(l,k,this)}}},{title:"Events",iconCls:"execute_icon",xtype:"propertygrid",nameColumnWidth:170,source:{},listeners:{render:function(k){f.eventGrid=k},validateedit:function(l,k){return j(l,k,this)}}}]},{store:{proxy:{type:"ajax",url:"main?xwl=13L88K98GZO2&id="+a,extraParams:{path:Ds.getIdePath()},listeners:{exception:function(l,k){Wb.except(k.responseText)}}},fields:Ds.objectTreeFields,root:{MODULE_ID:-1,children:[]},listeners:{beforeload:function(){Wb.mask(f)},load:function(o,p,k,l){Wb.unmask(f);if(!l){f.close();return}var m=f.objectTree,q=m.getRootNode().firstChild;m.view.select(q);if(q.isExpandable()){q.expand();q.eachChild(function(n){if(n.get("xwlMeta")=="viewport"&&n.isExpandable()){n.expand();n.eachChild(function(r){if(r.isExpandable()){r.expand()}})}})}if(h){h(m,f)}}}},rootVisible:false,animate:false,region:"center",iconCls:"list_icon",title:"Object TreeView",tools:[{type:"expand",tooltip:"Expand All",handler:function(){f.objectTree.selectObject.expand(true)}},{type:"collapse",tooltip:"Collapse All",handler:function(){f.objectTree.selectObject.collapse(true)}}],xtype:"treepanel",viewConfig:{plugins:{pluginId:"ddPlug",ptype:"treeviewdragdrop",ddGroup:"controlList"},listeners:{beforedrop:function(n,o,m,r){var l=Wb.getTree(o.item),k=l==Wb.get("controlTree"),q=Wb.getNode(n),p=Wb.getNode(o.item);if(k){o.copy=true}if(Ds.canDroped(p,q,r=="append")){this.beforeParent=p.parentNode;return true}else{return false}},drop:function(l,o,q,m){var k=Wb.getDropedNode(l,m),s=Wb.getTree(o.item),r=s==Wb.get("controlTree"),p,t;if(!r&&(k.parentNode!=this.beforeParent)){Ds.delPdObj(this.beforeParent,k.get("text"));p=Ds.findTab(k.parentNode);if(p){t=p.absPanel.add(Ds.getRendProp(k,8,8,k.get("text")));Ds.selectObj(t,false)}}Ds.setModified();if(r){Ds.renameNode(k,true);Ds.setDisplay(k);f.objectTree.view.select(k);p=Ds.findTab(k.parentNode);if(p){t=p.absPanel.add(Ds.getRendProp(k,8,8,k.get("text")));Ds.selectObj(t,false)}}}}},listeners:{render:function(k){f.objectTree=k},itemmousedown:function(k,l){Ds.moduleSeled=false;k.focus();Wb.setDDText(k,l.get("text"))},selectionchange:function(k,l,m){Ds.completeEdit();var p=l[0];f.objectTree.selectObject=p;d(p)}}}]}]});b.setActiveTab(f);f.objectTree.store.load()},decodeExpress:function(a){var c={},b;for(b in a){c[b]=Ext.decode(a[b])}return c},expPack:function(b){var a="&root="+(b?moduleTree.selectModule.get("MODULE_ID"):"-1");Wb.download("main?xwl=13O5703A1GTM"+a)},expModule:function(){var a=Ds.at();if(a&&a.objectTree){Wb.download("main?xwl=13O3H9TRCSYH",{title:a.orgTitle,moduleId:a.id.substring(2)})}else{Wb.warning("Please open a module to export.")}},impModule:function(){var a=Ds.at();if(a&&a.objectTree){impWin.impType=0;impWin.moduleId=a.id.substring(2);impWin.setTitle("Import to "+a.orgTitle);impWin.show()}else{Wb.warning("Please open a module to import.")}},impPack:function(){impWin.impType=1;impWin.setTitle("Import and merge modules");impWin.show()},finishImp:function(b){impWin.hide();var a;if(impWin.impType==0){a=Ds.at().objectTree;Wb.delModified(Ds.at());a.store.load({node:a.getRootNode()})}else{a=b;if(!Wb.isEmpty(a)){a="<br>Some duplicated modules id has been replaced:<br>"+a+"<br>"}Wb.confirm("Import successfully, reload the page?"+a,function(){Wd.wb_forceCls=true;location.reload()})}},doImp:function(){if(impWin.impType==0){form1.url="main?xwl=13O3FO5EYL83";Wb.upload(form1,{moduleId:impWin.moduleId})}else{form1.url="main?xwl=13O5703A1GTK";Wb.upload(form1)}},mdBeforeChg:function(e,d,g){Ds.svPos(1);if(g&&g.tabBar&&g.tabBar.layout){g.saveScrollPos=g.tabBar.layout.overflowHandler.getScrollPosition()}Ds.completeEdit();if(g&&!g.saveUrl){var f;f=g.getActiveTab();if(f&&f.commitChange){f.commitChange()}}},mdChg:function(e,d,f){Ds.rsPos(1);if(d&&d.saveScrollPos!==undefined){d.tabBar.layout.overflowHandler.scrollTo(d.saveScrollPos,false)}Wb.recNav(d,f,backBtn);if(d.isSaving){Wb.mask(d,Str.saving)}},completeEdit:function(){var a=Ds.at();if(a){a=a.contentTab;if(a){a=a.getActiveTab()}if(a){a.plugins[0].completeEdit()}}},setModified:function(){Wb.setModified(Ds.at());Ds.setSaveBtn()},setSaveBtn:function(){var b=true,a=true;moduleTab.items.each(function(d){if(d.isModified){a=false;if(d==Ds.at()){b=false;return false}}});saveBtn.setDisabled(b);saveAllBtn.setDisabled(a)},getModifiedTitle:function(){var a=moduleTab,b=null;a.items.each(function(d){if(d.isModified){b=d.orgTitle;a.setActiveTab(d);return false}});return b},addIconItem:function(g,c){var f=g.getValue(),h=g.displayField,a=g.valueField,b=g.store,j,e;if(Ext.isEmpty(f)){f=""}if(g.isValid()&&!Wb.findRecord(b,h||a,f)){j={field1:f,field2:f,field3:"item"};b.clearFilter();if(Ext.isDefined(c)){e=c;if(e<0){e=b.count()+e+1}b.insert(e,j)}else{b.add(j)}g.setValue(g.getValue())}},monitorIconFocus:function(b){b.allowChange=true;Ds.addIconItem(b);var a=Wb.findRecord(b.store,b.displayField,"");if(a){b.store.remove(a)}},monitorBindFocus:function(d){var c,b=Ds.at().objectTree,a;d.allowChange=true;d.store.removeAll();d.bindItems=[];if(d.bindType=="owned"){a=null}else{if(d.bindType=="dOwned"){a=undefined}else{a=d.bindType}}Ds.scanBindObj(b.getRootNode(),d.store,d.bindItems,a,b.selectObject);d.store.clearFilter();d.store.sort("field1","ASC")},scanBindObj:function(f,i,d,g,h){var b,k,a,j,e;if(g===null){e=0}else{if(g===undefined){e=1}else{e=2}}f.eachChild(function(c){b=c.get("xwlCategory");k=Wb.getNamePart(g);if(k=="array"){a=Wb.getValuePart(g);if(Wb.isEmpty(a)){a=null}else{a=a.split(",")}}else{a=null}if((Wb.isEmpty(a)||c.firstChild&&Wb.indexOf(a,c.firstChild.get("xwlMeta"))!=-1)&&(Wb.isEmpty(k)||Wb.indexOf(k,c.get("xwlMeta"))!=-1||(!Wb.isEmpty(b)&&Wb.isAcross(k.split(","),b.split(","))))&&(e==2||e==0&&c.isAncestor(h)||e==1&&c.parentNode==h)){j=c.get("text");d.push(j);i.add({field1:j})}Ds.scanBindObj(c,i,d,g,h)})},getIdePath:function(){var a;if(idepath!=="-"){a=Wb.getSelNode(moduleTree);if(a){return a.getPath("MODULE_ID","\n")}}return""},edtBind:function(a,b){return new Ext.form.field.ComboBox({store:[""],queryMode:"local",enableKeyEvents:true,typeAhead:true,bindType:a,isDsCombo:true,multiSelect:b,enableKeyEvents:true,listeners:{change:Ds.monitorChange,focus:Ds.monitorBindFocus}})},edtIcon:function(){return new Ext.form.field.ComboBox({store:Ds.iconList,queryMode:"local",enableKeyEvents:true,typeAhead:true,isDsCombo:true,listConfig:{getInnerTpl:function(){return'<div style="background-image:url(webbuilder/images/{field3}.gif);" class="wb_combo_icon">{field1}</div>'}},listeners:{change:Ds.monitorChange,focus:Ds.monitorIconFocus}})},edtDate:function(){return new Ext.form.field.Date({format:"Y-m-d",isDsCombo:true,getErrors:function(a){return[]},rawToValue:function(a){return this.parseDate(a,"Y-m-d")||a||""},getValue:function(){var c=this,d=c.rawToValue(c.processRawValue(c.getRawValue())),a,b;c.value=d;a=c.valueToRaw(d);b=Wb.optString(a).split("-");if(b.length==3&&Ext.isNumeric(b[0])&&Ext.isNumeric(b[1])&&Ext.isNumeric(b[2])){return"new Date("+parseInt(b[0],10)+","+(parseInt(b[1],10)-1)+","+parseInt(b[2],10)+")"}else{return a}},valueToRaw:function(a){return this.formatDate(this.parseDate(a,"Y-m-d"),"Y-m-d")||a||""},enableKeyEvents:true,listeners:{change:Ds.monitorChange,focus:Ds.monitorFocus}})},edtColor:function(){return new Wb.ide.ColorField({isDsCombo:true,enableKeyEvents:true,listeners:{change:Ds.monitorChange,focus:Ds.monitorFocus}})},edtUrl:function(a){return new Ext.form.field.Trigger({enableKeyEvents:true,onTriggerClick:a?Ds.promptUrls:Ds.promptUrl,enableKeyEvents:true,isUrl:true,listeners:{change:Ds.monitorChange,focus:Ds.monitorFocus,render:Ds.populateDblClick},editable:true,triggerCls:"ellipsis_icon"})},edtBool:function(){return Ds.edtEnum(["true","false"])},edtJndi:function(){return Ds.edtEnum(Ds.jndiList)},edtEnum:function(a,b){var c;if(Ext.isString(a)){c=a.split(",")}else{c=a}return new Ext.form.field.ComboBox({store:c,queryMode:"local",typeAhead:true,isDsCombo:true,multiSelect:b,enableKeyEvents:true,listeners:{change:Ds.monitorChange,focus:Ds.monitorCbFocus}})},edtTrigger:function(a){return new Ext.form.field.Trigger({enableKeyEvents:true,type:a,onTriggerClick:function(c){var b;if(c.isTriggerField){b=c}else{b=this}Ds.addSE(b,b.type)},enableKeyEvents:true,listeners:{render:Ds.populateDblClick},editable:false,blockPost:true,fieldStyle:"background-color:#D0D0D0;background-image:none",triggerCls:"ellipsis_icon"})},edtText:function(a){var b={enableKeyEvents:true,hideTrigger:true,listeners:{change:Ds.monitorChange,focus:Ds.monitorFocus}};if(a=="id"){b.allowBlank=false;b.validator=Ds.idValidator}return new Ext.form.field.Trigger(b)},ar:function(a){var d=Ds.at(),c=d&&d.contentTab?d.contentTab.getActiveTab():null,b;if(c){b=c.plugins[0].activeRecord;return b?b.get(a?"value":"name"):null}return null},svPos:function(c){var d=Ds.at();if(d&&d.generalTab&&d.getActiveTab()==d.generalTab){if(!d.propertyGrid.hidden){d.svU1=d.propertyGrid.view.el.dom.scrollTop}if(!d.eventGrid.hidden){d.svU2=d.eventGrid.view.el.dom.scrollTop}if(c){d.svU3=d.objectTree.view.el.dom.scrollTop}}},rsPos:function(d){var e=Ds.at(),c;if(e&&e.generalTab&&e.getActiveTab()==e.generalTab){if(e.svU1!==undefined&&!e.propertyGrid.hidden){c=e.propertyGrid.view.el.dom;c.scrollTop=0;c.scrollTop=e.svU1}if(e.svU2!==undefined&&!e.eventGrid.hidden){c=e.eventGrid.view.el.dom;c.scrollTop=0;c.scrollTop=e.svU2}if(d&&e.svU3!==undefined){c=e.objectTree.view.el.dom;c.scrollTop=0;c.scrollTop=e.svU3}}},ajustAbsPos:function(c,b){var e=Ds.pn(),a=0,g,d,f;e.items.each(function(h){if(h.ideSel){g=h;d=Ext.fly(h.id+"-rzwrap");f=Ds.gxy(h);a++;switch(c){case 37:if(b){d.setWidth(h.getWidth()-1);h.setWidth(h.getWidth()-1)}else{d.setLeft(f[0]-1)}break;case 38:if(b){d.setHeight(h.getHeight()-1);h.setHeight(h.getHeight()-1)}else{d.setTop(f[1]-1)}break;case 39:if(b){d.setWidth(h.getWidth()+1);h.setWidth(h.getWidth()+1)}else{d.setLeft(f[0]+1)}break;case 40:if(b){d.setHeight(h.getHeight()+1);h.setHeight(h.getHeight()+1)}else{d.setTop(f[1]+1)}break}}});if(a==1){Ds.updateAbsInfo(g)}if(a>0){Ds.setModified()}},selAllItems:function(){Ds.selectAll(Ds.pn(),true)},monitorKey:function(h,i){Ds.ctrlKey=h.ctrlKey;if(h.ctrlKey){if(Ds.urlWin&&Ds.urlWin.isVisible()||Ds.urlsWin&&Ds.urlsWin.isVisible()){return}var f=h.getTarget(),g=h.getKey(),b=String.fromCharCode(g),a=Ds.at(),d=a&&!a.saveUrl?a.getActiveTab():null,c;if(a&&a.saveUrl){return}Ds.keyCode=g;if((b=="C"||b=="V"||b=="X"||b=="A"||g>36&&g<41)&&(Wb.isEditor(f)||d&&d.scriptEditor&&!Ds.slModule())){return}if(g==46){if(h.shiftKey){Ds.removeChildren()}else{Ds.removeControl()}return}c=d&&d.absPanel;if(g>36&&g<41&&c){h.stopEvent();Ds.ajustAbsPos(g,h.shiftKey);return}switch(b){case"A":if(c){h.stopEvent();Ds.selectAll(c,true)}break;case"X":h.stopEvent();Ds.cutControl();break;case"Q":h.stopEvent();Ds.delayRun();break;case"J":h.stopEvent();Ds.showGeneral();break;case"K":h.stopEvent();searchBtn.fireEvent("click");break;case"C":h.stopEvent();Ds.copyControl();break;case"E":h.stopEvent();Ds.getModuleProperties();break;case"N":h.stopEvent();Ds.createModule(h.shiftKey);break;case"M":h.stopEvent();Ds.createFolder(h.shiftKey);break;case"D":if(d&&d.scriptEditor){return}h.stopEvent();Ds.editAbsLayout();break;case"V":h.stopEvent();Ds.pasteControl();break;case"S":h.stopEvent();if(h.shiftKey){Ds.delaySave(true)}else{Ds.delaySave(false)}break}}},monitorChange:function(a){if(a.allowChange&&a.isValid()){Ds.setProperty(a)}},monitorFocus:function(a){a.allowChange=true},monitorCbFocus:function(a){a.allowChange=true},promptUrl:function(a){Ds.promptResource.call(this,a,false)},promptUrls:function(a){Ds.promptResource.call(this,a,true)},promptResource:function(a,e){var i,b,g=Ds.at(),d=g.propertyGrid,h,f,c=Ds.ar();Ds.completeEdit();f=[{tooltip:Str.refresh,handler:function(){if(Wb.get("urlSelPanel"+e).getActiveTab()==Wb.get("urlModPanel"+e)){Wb.refresh(Wb.get("urlTree"+e),"MODULE_ID")}else{Wb.refresh(Wb.get("resourceTree"+e),"text")}},type:"refresh"}];if(e){h=Ds.urlsWin;f.push({tooltip:"Uncheck All",type:"minus",handler:function(){var j;if(Wb.get("urlSelPanel"+e).getActiveTab()==Wb.get("urlModPanel"+e)){j="urlTree"}else{j="resourceTree"}Wb.check(Wb.get(j+e),false,false,true)}})}else{h=Ds.urlWin}if(h){h.thePg=d;h.theXn=c;h.show()}else{new Ext.window.Window({title:"Resource Selector",width:400,height:430,layout:"fit",closeAction:"hide",iconCls:"web_icon",tools:f,okHandler:function(){var m=Wb.get("urlTree"+e),j=Wb.get("resourceTree"+e),k,l;if(Wb.get("urlSelPanel"+e).getActiveTab()==Wb.get("urlModPanel"+e)){if(e){k=m.getChecked();i=[];Ext.Array.each(k,function(o){i.push("#"+o.get("MODULE_ID")+" ("+o.get("orgText")+")")});i=Ext.encode(i)}else{b=Wb.getSelNode(m);if(b.get("IS_FOLDER")){return}i="#"+b.get("MODULE_ID")+" ("+b.get("orgText")+")"}}else{if(e){k=j.getChecked();i=[];Ext.Array.each(k,function(o){l=o.getPath("text","/");l=l.substring(l.indexOf("/",1)+1);i.push(l)});i=Ext.encode(i)}else{b=Wb.getSelNode(j);if(b.get("isDir")){return}i=b.getPath("text","/");i=i.substring(i.indexOf("/",1)+1)}}h.thePg.setProperty(h.theXn,i);Ds.setModified();h.hide()},buttons:[{text:Str.ok,iconCls:"ok_icon",handler:Wb.okHandle},{text:Str.cancel,iconCls:"cancel_icon",handler:Wb.cancelHandle}],modal:true,resizable:false,listeners:{render:function(j){if(e){Ds.urlsWin=j}else{Ds.urlWin=j}j.thePg=d;j.theXn=c;h=j;Wb.monEnter(j)},show:function(){if(e){Wb.check(Wb.get("urlTree"+e),false,false,true);Wb.check(Wb.get("resourceTree"+e),false,false,true)}}},items:[{xtype:"tabpanel",id:"urlSelPanel"+e,items:[{title:"Modules",id:"urlModPanel"+e,layout:"fit",iconCls:"module_icon",xtype:"panel",items:[{xtype:"treepanel",id:"urlTree"+e,store:{proxy:{type:"ajax",url:"main?xwl=13L88K98GZO3&check="+e,listeners:{exception:function(k,j){Wb.except(j.responseText)}}},fields:Ds.moduleTreeFields,listeners:{beforeload:function(k,j){j.params.parentId=j.node.get("MODULE_ID")}},sorters:[{property:"ORDER_INDEX",direction:"ASC"}]},rootVisible:false,animate:false,listeners:{itemdblclick:function(j){if(!e){h.okHandler()}}}}]},{title:"Server Files",id:"urlResPanel"+e,layout:"fit",iconCls:"resource_icon",xtype:"panel",items:[{xtype:"treepanel",id:"resourceTree"+e,store:{proxy:{type:"ajax",url:"main?xwl=13M5W3GMF7ZS&check="+e,listeners:{exception:function(k,j){Wb.except(j.responseText)}}},fields:[{name:"text"},{name:"dir"},{name:"isDir"}],listeners:{beforeload:function(k,j){var l;if(Wb.isEmpty(j.node.get("dir"))){l="@"}else{l=j.node.get("dir")}j.params.dir=l}}},rootVisible:false,animate:false,listeners:{itemdblclick:function(j){if(!e){h.okHandler()}}}}]}]}]}).show()}},populateDblClick:function(a){a.isTriggerField=true;a.inputEl.dom.ondblclick=function(){a.onTriggerClick(a)}},close:function(b){var c,a=moduleTab;if(b<3){c=a.getActiveTab();a.items.each(function(d){if(b==1||c!=d){if(d.isModified){a.setActiveTab(d);Wb.choose(Wb.format(Str.saveConfirm,d.title.substring(1)),function(e){if(e=="yes"){Ds.saveModule(false,function(){Ds.close(b)})}else{if(e=="no"){d.isModified=false;Ds.close(b)}}});return false}else{d.close()}}})}else{a=a.getActiveTab();if(a&&a.generalTab){c=a.getActiveTab();if(b==3){a.setActiveTab(a.generalTab)}a.items.each(function(d){if(d!=a.generalTab&&(b==3||c!=d)){d.close()}})}}},addSE:function(obj,type){function setScript(edit){var p=selObj.get("properties")[propName]!=null,v=edit.getValue();if(p){if(pg.source==selObj.get("properties")){pg.setProperty(propName,v)}else{selObj.get("properties")[propName]=v}}else{if(eg.source==selObj.get("events")){eg.setProperty(propName,v)}else{selObj.get("events")[propName]=v}}}var page=Ds.at(),pg=page.propertyGrid,eg=page.eventGrid,propName=Ds.ar(),val=Ds.ar(true),selObj=page.objectTree.selectObject,objName=selObj.get("text"),scriptEditor,ex=false,scriptTabObj,pHint,edtId;Ds.completeEdit();page.items.each(function(x){if(x.bindObj===selObj&&x.bdPropName===propName){page.setActiveTab(x);ex=true;return false}});if(ex){return}pHint=selObj.get("custEPara")[propName];if(Ext.isEmpty(pHint)){pHint=""}else{pHint="function("+pHint+")"}edtId=Ds.getId();page.add({iconCls:type+"_icon",title:objName+"."+propName,closable:true,isScriptEdt:true,bindObj:selObj,bdPropName:propName,layout:"fit",bbar:[type=="js"||type=="ss"?{iconCls:"ok_icon",tooltip:"Verify Script",handler:function(){try{eval("function sys_wb_verify(){"+scriptEditor.getValue()+"}");Wb.message("Verify Successful.")}catch(e){Wb.error(e.message)}}}:{iconCls:"null_icon",disabled:true}," ",{text:"1 : 1",xtype:"tbtext",listeners:{render:function(t){scriptTabObj.cursorLabel=t}}},"->",{text:pHint,xtype:"tbtext"}],listeners:{render:function(t){scriptTabObj=t;t.commitChange=function(){if(t.isModified){setScript(scriptEditor);t.isModified=false}};scriptEditor=CodeMirror.fromTextArea(Wb.dom(edtId),{lineNumbers:true,mode:type=="sql"?"text/x-plsql":(type=="js"||type=="ss"?"text/javascript":"text/html"),onChange:function(){if(scriptEditor.sttChg){scriptTabObj.isModified=true;Ds.setModified()}},onCursorActivity:function(){var o=scriptEditor.getCursor();scriptTabObj.cursorLabel.setText((o.line+1)+":"+(o.ch+1))}});t.scriptEditor=scriptEditor},destroy:function(t){Wb.closeNav(backBtn,forwardBtn,t)},resize:function(a,b,c){Ext.fly(scriptEditor.getScrollerElement()).setHeight(c-32);scriptEditor.refresh()},activate:function(t){Ds.focusEdt(scriptEditor)}},items:[{xtype:"panel",html:'<div id="'+edtId+'"></div>'}]});page.setActiveTab(scriptTabObj);scriptEditor.setValue(val);scriptEditor.sttChg=1},focusEdt:function(a){setTimeout(function(){a.focus()},20)},getNodeData:function(c,b){c.xwlMeta=b.get("xwlMeta");var f,d=b.get("properties"),a,g;for(a in d){if(!Ext.isEmpty(d[a])){c[a]=d[a]}}f=b.get("events");for(a in f){if(!Ext.isEmpty(f[a])){c[a]=f[a]}}if(b.hasChildNodes()){c.children=[];b.eachChild(function(e){g={};Ds.getNodeData(g,e);c.children.push(g)})}},delaySave:function(a,b){if(!Ds.delaySv){Ds.delaySv=new Ext.util.DelayedTask(Ds.saveModule)}Ds.delaySv.delay(102,null,null,[a,b])},saveModule:function(c,g){var i,h,b={},f=moduleTab,a=f.getActiveTab(),e=[];if(a==null||a.saveUrl){return}h=a.getActiveTab();if(h.commitChange){h.commitChange()}f.items.each(function(d){if(d.isModified&&!d.isSaving&&(c||d==a)){i={};e.push(d);d.isSaving=true;Wb.mask(d,Str.saving);Ds.getNodeData(i,d.objectTree.getRootNode().firstChild);b["xwl_"+d.id.substring(2)]=Ext.encode(i)}});if(e.length>0){Wb.request({url:"main?xwl=13L88K98GZO4",params:b,showMask:false,callback:function(){Ext.Array.each(e,function(d){d.isSaving=false;Wb.unmask(d)})},success:function(d){f.items.each(function(j){if(j.isModified&&(c||j==a)){Wb.delModified(j)}});Ds.setSaveBtn();if(g){g()}},failure:function(d){Wb.except(d.responseText)}})}},createModule:function(b){Ds.isFolder=false;Ds.isInsert=b;var a=newWin;a.show();Ds.setWinProp(false);a.setTitle((b?"Insert":"New")+" Module");a.setIconCls("new_icon");newWinCheck.setDisabled(false);a.center()},createFolder:function(b){Ds.isFolder=true;Ds.isInsert=b;var a=newWin;a.show();Ds.setWinProp(false);a.setTitle((b?"Insert":"New")+" Folder");a.setIconCls("folder_icon");newWinCheck.setDisabled(true);a.center()},finalize:function(){Ext.getDoc().on("keydown",Ds.monitorKey)},cloneNodeProperty:function(b){var a,f,d={},c={};f=b.get("properties");for(a in f){d[a]=f[a]}f=b.get("events");for(a in f){c[a]=f[a]}b.set("properties",d);b.set("events",c);b.commit()},setWinProp:function(a){var b=newWin;if(a){b.setHeight(265);hiddenCheck.el.setTop(172);newWinCheck.el.setTop(172)}else{b.setHeight(170);hiddenCheck.el.setTop(77);newWinCheck.el.setTop(77)}createDate.setVisible(a);lastModiDate.setVisible(a);createLabel.setVisible(a);lastModiLabel.setVisible(a);idLabel.setVisible(a);moduleIdEdit.setVisible(a)},locateItem:function(a){var c=a,b,g,e,d;Ds.createTab(c.get("module"),c.get("moduleId"),c.get("iconCls"),function(f,h){h.setActiveTab(h.generalTab);b=c.get("name");e=b.indexOf(".");g=f.getRootNode().findChild("text",b.substring(0,e),true);if(g){f.selectPath(g.getPath("text"),"text");f.view.select(g);b=b.substring(e+1);d=Wb.findRecord(h.propertyGrid.store,"name",b);if(!Ds.delayFcp){Ds.delayFcp=new Ext.util.DelayedTask(function(j,i){j.startEdit(i,1)})}if(d){h.contentTab.setActiveTab(h.propertyGrid);Ds.delayFcp.delay(50,null,null,[h.propertyGrid.plugins[0],d])}else{d=Wb.findRecord(h.eventGrid.store,"name",b);if(d){h.contentTab.setActiveTab(h.eventGrid);Ds.delayFcp.delay(50,null,null,[h.eventGrid.plugins[0],d])}}}})},getModuleProperties:function(){var a=moduleTree.selectModule,b,c;if(a==null){Wb.warning("Please select a module.");return}Ds.isFolder="property";b=newWin;c=a.get("IS_FOLDER");b.show();Ds.setWinProp(true);titleEdit.setValue(a.get("orgText"));iconCombo.setValue(a.get("iconCls"));moduleIdEdit.setValue(a.get("MODULE_ID"));hiddenCheck.setValue(a.get("IS_HIDDEN"));newWinCheck.setValue(a.get("NEW_WIN"));newWinCheck.setDisabled(c);createDate.setValue(Wb.dateToStr(a.get("CREATE_DATE")));lastModiDate.setValue(Wb.dateToStr(a.get("LAST_MODIFY_DATE")));if(c){b.setTitle("Folder Properties")}else{b.setTitle("Module Properties")}b.setIconCls("property_icon");b.center()},setModule:function(){var c=moduleTree,a=c.selectModule,g=a.get("MODULE_ID"),f=titleEdit.getValue(),d=iconCombo.getValue(),e=hiddenCheck.getValue()?1:0,b=newWinCheck.getValue()?1:0;Wb.request({url:"main?xwl=13L88K98GZOF",message:Str.saving,params:{title:f,icon:d,newWin:b,hidden:e,id:g},success:function(l){var i=Ext.decode(l.responseText),k,j,h=e==1,m=b==1;if(h){a.set("cls","wb_blue")}else{a.set("cls","")}a.set("text",i.title);a.set("orgText",f);a.set("iconCls",d);a.set("IS_HIDDEN",h);a.set("NEW_WIN",m);a.set("LAST_MODIFY_USER",i.user);a.set("LAST_MODIFY_DATE",i.date);a.commit();k=Wb.get("t_"+g);if(k){j=Wb.ellipsis(i.title);k.setIconCls(d);k.setTitle((k.isModified?"*":"")+j);k.orgTitle=i.title;if(j!==i.title){if(k.ellipsisTip){k.ellipsisTip.update(i.title)}else{k.ellipsisTip=new Ext.tip.ToolTip({target:k.tab.btnWrap,html:i.title})}}else{if(k.ellipsisTip){Ext.destroy(k.ellipsisTip);k.ellipsisTip=null}}}newWin.hide()}})},newModule:function(){var c=moduleTree,a=c.selectModule,b,d=a?a.parentNode:null;if(a){if(a.get("IS_FOLDER")){b=a}else{b=d}}else{b=c.getRootNode()}b.expand(false,function(){var l,g,k,f,j=titleEdit.getValue(),h=iconCombo.getValue(),i=hiddenCheck.getValue()?1:0,e=newWinCheck.getValue()?1:0;if(a){k=a.getDepth();if(Ds.isInsert){if(k==1){l="-1"}else{l=d.get("MODULE_ID")}f=d;g=a.get("ORDER_INDEX")}else{if(a.get("IS_FOLDER")){l=a.get("MODULE_ID");g=a.lastChild?a.lastChild.get("ORDER_INDEX")+1:1;f=a}else{if(k==1){l="-1"}else{l=d.get("MODULE_ID")}f=d;g=d.lastChild?d.lastChild.get("ORDER_INDEX")+1:1}}}else{l="-1";f=c.getRootNode();if(Ds.isInsert){g=1}else{g=f.lastChild?f.lastChild.get("ORDER_INDEX")+1:1}}Wb.request({url:"main?xwl=13L88K98GZOC",message:Str.creating,params:{title:j,icon:h,hidden:i,newWin:e,parentId:l,orderIndex:g,content:Ds.isFolder?"":Ext.encode({xwlMeta:"module",id:"module",title:j})},success:function(q){var t,s,m=Ext.decode(q.responseText),o=m.info,p;f.eachChild(function(n){s=n.get("ORDER_INDEX");if(s>=g){n.set("ORDER_INDEX",s+1);n.commit()}});p={text:o.title,orgText:j,iconCls:h,MODULE_ID:o.id,PARENT_ID:l,CREATE_USER:o.user,CREATE_DATE:o.date,LAST_MODIFY_DATE:o.date,IS_HIDDEN:i==1,NEW_WIN:e==1,IS_FOLDER:Ds.isFolder,ORDER_INDEX:g,leaf:!Ds.isFolder,children:[]};if(i){p.cls="wb_blue"}newWin.hide();if(Ds.isInsert){if(a){t=f.insertBefore(p,a)}else{if(c.getRootNode.firstChild){t=f.insertBefore(p,c.getRootNode.firstChild)}else{t=f.appendChild(p)}}}else{t=f.appendChild(p)}c.view.select(t);if(!Ds.isFolder){Ds.createTab(o.title,o.id,h)}}})})},saveModuleTree:function(e,g,i,f){var k=moduleTree,j=Wb.getNode(e),b=Wb.getNode(g.item),c,a,h,d;Wb.mask(k);j.expand(false,function(){Wb.unmask(k);a=b.get("MODULE_ID");if(f=="append"){d=j;h=j.get("MODULE_ID");c=j.lastChild.previousSibling?j.lastChild.previousSibling.get("ORDER_INDEX")+1:1}else{d=b.parentNode;if(b.getDepth()==1){h="-1"}else{h=d.get("MODULE_ID")}if(f=="before"){c=j.get("ORDER_INDEX")}else{c=j.get("ORDER_INDEX")+1}}Wb.request({url:"main?xwl=13L88K98GZOE",mask:k,params:{orderIndex:c,srcId:a,parentId:h},failure:function(){Wb.revertNodePos(b)},success:function(){d.eachChild(function(l){var m=l.get("ORDER_INDEX");if(m>=c){l.set("ORDER_INDEX",m+1);l.commit()}});b.set("PARENT_ID",h);b.set("ORDER_INDEX",c);b.commit()}})})},delModule:function(a){var c=moduleTree,d=c.selectModule,b;if(!d){Wb.warning("Please select module you want to delete.");return}if(a){b='Are you sure you want to delete "{0}"?'}else{b='Are you sure you want to delete children of "{0}"?'}Wb.confirm(Wb.format(b,d.get("text")),function(){var e=d.get("MODULE_ID");Wb.request({url:"main?xwl=13L88K98GZOD",mask:c,params:{id:e,isAll:a},success:function(l){if(a){Wb.delSelNode(c)}else{d.removeAll()}var k=l.responseText.split(","),h,g=k.length,f;for(h=0;h<g;h++){f=Wb.get("t_"+k[h]);if(f){f.isModified=false;f.close()}}}})},c.view.getNode(d))},refresh:function(){Wb.confirm("Are you sure you want to refresh the system?",function(){Wb.request({url:"main?xwl=13O3FEKV30SJ",success:function(){Wb.message("The system has been refreshed.")}})})},changeId:function(b,c){var a,d;b.set("text",c);b.commit();Ds.at().items.each(function(e){if(e.bindObj==b){if(e.bdPropName){e.setTitle(c+"."+e.bdPropName)}else{e.setTitle(c);e.xwlId=c}}});a=Ds.findTab(b.parentNode);if(a){a=a.absPanel;if(a){d=Ds.findObj(a,b);if(d.xwlId){d.xwlId=c}else{d.setValue(c)}}}},idValidator:function(a){if(!this.ownerCt.isVisible()){return true}var b=Ds.at().objectTree,e=b.getRootNode(),d=b.selectObject,c=a.toUpperCase(),f=e.findChildBy(function(){return this.get("text").toUpperCase()==c},null,true);if(Wb.verifyName(a)!==true){return Wb.format(Str.invalidName,a)}if(f!=null&&f!=d){return Wb.format(Str.alreadyExists,a)}return true},idValidatorBd:function(a){var b=Ds.at().objectTree,d=b.getRootNode(),c=a.toUpperCase(),e=d.findChildBy(function(){return this.get("text").toUpperCase()==c},null,true);if(Wb.verifyName(a)!==true){return Wb.format(Str.invalidName,a)}if(e!=null&&e!=this.bindNode){return Wb.format(Str.alreadyExists,a)}return true},setProperty:function(f){var e=Ds.at(),d=e.contentTab.getActiveTab(),b=Ds.ar(),c=f.getValue();if(c==null){c=""}if(b!=null){if(d.source[b]===c){return}d.source[b]=c;if(b=="id"){Ds.changeId(e.objectTree.selectObject,c)}}Ds.setModified()},canDroped:function(d,g,c){if(d==null||g==null){return false}function f(k,h,l){var j=k.split(","),i;if(l){i=l.split(",")}else{i=[]}i.push(h);return Wb.isAcross(j,i)}var e,b,a;if(g.getDepth()==1&&!c){return false}if(c){e=g}else{e=g.parentNode}b=d.get("xwlParent");a=e.get("xwlChildren");return(a=="*"||a!=null&&f(a,d.get("xwlMeta"),d.get("xwlCategory")))&&(b=="*"||b!=null&&f(b,e.get("xwlMeta"),e.get("xwlCategory")))},renameNode:function(f,b){Ds.cloneNodeProperty(f);var e=Wb.getRootNode(f),d=1,c,a=f.get("properties").id;if(b){do{c=a+(d++)}while(e.findChild("text",c,true))}else{c=a;f.set("text",".");while(e.findChild("text",c,true)){c=a+(d++)}}f.get("properties").id=c;f.set("text",c);f.commit()},getSelNode:function(){var a=Ds.at();if(a==null){return}return a.objectTree.selectObject},getSnap:function(b){var a=b%8;b=b-a;if(a>4){return b+8}return b},ssz:function(g,a,f,b,d){var e=Ext.fly(g.id+"-rzwrap");e.setLeftTop(a,f);e.setWidth(b);e.setHeight(d);g.setWidth(b);g.setHeight(d)},dragHandle:function(f){var e=f.lastXY,c=Ds.getSnap(e[0]-f.sfx),b=Ds.getSnap(e[1]-f.sfy),a=0,d;Ds.pn().items.each(function(g){if(g.ideSel){a++;d=g;Ext.fly(g.id+"-rzwrap").setLeftTop(g.orgFx+c,g.orgFy+b)}});if(a==1){Ds.updateAbsInfo(d)}Ds.setModified()},gxy:function(b){var a=Ds.pn().el.getXY(),d=b.el.getXY();return[d[0]-a[0]-1,d[1]-a[1]-1]},dragMousedown:function(g,d){if(d.target.clientWidth==5&&d.target.clientHeight==5){return false}var c=g.lastXY,a=Ds.pn(),b=a.el.getXY(),f;g.sfx=c[0];g.sfy=c[1];a.items.each(function(e){f=e.el.getXY();e.orgFx=f[0]-b[0]-1;e.orgFy=f[1]-b[1]-1})},restore:function(){Wb.confirm("Are you sure you want to restore?",function(){Wb.request({url:"main?xwl=13NU7H8CPISE",timeout:-1,output:findBk,failureConfirm:function(){findBk.focus(false,true)},success:function(){restoreWin.hide();Wb.message("Restore successfully. Please click OK to reload the page.",function(){Wd.wb_forceCls=true;location.reload()})}})})},backup:function(){Wb.prompt("Backup",[{text:"Title",value:"Backup",allowBlank:false}],function(a){Wb.request({url:"main?xwl=13NU7H8CPISB",timeout:-1,params:{title:a[0]},failureConfirm:function(){Wb.promptEditors[0].focus(false,true)},success:function(){Wb.closePrompt();Wb.message("Backup successfully.")}})},false)},propEventHandle:{change:function(b){if(Ds.stopRecChg){return}if(!b.isValid()){return}var a=Ds.at().getActiveTab();if(!a.absPanel){return}Ds.stopSetProp=true;if(b.xwlId){a.textEdit.setValue(b.getValue())}else{Ds.changeId(b.bindNode,b.getValue());if(a.idEdit.getValue().substring(0,1)!="("){a.idEdit.setValue(b.getValue())}}Ds.setModified();Ds.stopSetProp=false},render:function(c){var a=false;if(c.inputEl){c.inputEl.dom.ondblclick=function(){if(Ext.EventObject.ctrlKey){a=true;c.focus(true)}};c.inputEl.dom.onblur=function(){a=false;if(!c.isValid()){Ds.stopRecChg=true;c.setValue(c.bindNode.get("text"));Ds.stopRecChg=false}};c.inputEl.dom.onfocus=function(){if(!a){this.blur()}}}}},showGeneral:function(){var a=Ds.at();if(a&&a.generalTab){a.setActiveTab(a.generalTab)}},getRendProp:function(i,q,o,g){var a={},m=i.get("properties"),e=m.id,l,f,h=i.get("xwlXtype"),c=i.get("xwlCategory"),k=i.get("xwlMinWidth"),b=i.get("xwlMaxWidth"),s=i.get("xwlMinHeight"),p=i.get("xwlMaxHeight"),n=Ext.isEmpty(m.width),j=Ext.isEmpty(m.height);if(!Ext.isEmpty(g)){e=g}if(Ext.isEmpty(m.x)){a.x=q}else{a.x=parseInt(m.x,10)}if(Ext.isEmpty(m.y)){a.y=o}else{a.y=parseInt(m.y,10)}if(n){l=i.get("xwlWidth");if(Ext.isEmpty(l)){l=100}else{l=parseInt(l,10)}a.width=l}else{a.width=parseInt(m.width,10)}if(j){f=i.get("xwlHeight");if(Ext.isEmpty(f)){f=100}else{f=parseInt(f,10)}a.height=parseInt(f,10)}else{a.height=parseInt(m.height,10)}if(h=="label"){a.value=m.text;a.hasText=true;h="textarea";a.fieldCls="ide_label";a.isLabel=true;if(!Ext.isEmpty(m.align)){a.fieldStyle="text-align:"+m.align;a.fsSeted=true}a.xwlId=e}else{if(Wb.indexOf(c,"trigger")!=-1){a.value=e;a.allowBlank=false;h="trigger";a.validator=Ds.idValidatorBd;a.fieldStyle="cursor:move;"}else{if(Wb.indexOf(c,"text")!=-1){a.value=e;a.allowBlank=false;a.validator=Ds.idValidatorBd;if(h=="textarea"){a.fieldStyle="cursor:move;text-align:center;"}else{a.fieldStyle="cursor:move;"}h="textfield"}else{if(Wb.indexOf(c,"button")!=-1){a.value=m.text;a.hasText=true;h="textfield";a.fieldCls="ide_button";a.xwlId=e}else{if(Wb.indexOf(c,"grid")!=-1){a.value=e;a.allowBlank=false;a.validator=Ds.idValidatorBd;h="textfield";a.fieldStyle="background-image:url(webbuilder/images/app/grid.gif)";a.fieldCls="ide_grid"}else{if(Wb.indexOf(c,"date")!=-1){a.value=e;a.allowBlank=false;a.validator=Ds.idValidatorBd;h="textfield";a.fieldCls="ide_date"}else{if(Wb.indexOf(c,"check")!=-1){a.value=e;a.allowBlank=false;a.validator=Ds.idValidatorBd;h="textfield";a.fieldCls="ide_check"}else{if(Wb.indexOf(c,"radio")!=-1){a.value=e;a.allowBlank=false;a.validator=Ds.idValidatorBd;h="textfield";a.fieldCls="ide_radio"}else{if(Wb.indexOf(c,"image")!=-1){a.value=e;a.allowBlank=false;a.validator=Ds.idValidatorBd;h="textfield";a.fieldCls="ide_image";if(!Wb.isEmpty(m.src)){a.fieldStyle="background-image:url("+m.src+");"}}else{a.value=e;a.allowBlank=false;a.validator=Ds.idValidatorBd;h="textfield";a.fieldCls="ide_panel"}}}}}}}}}a.listeners=Ds.propEventHandle;a.xtype=h;a.bindNode=i;a.resizable={widthIncrement:8,heightIncrement:(a.height%8!=0&&!p)?2:8,listeners:{resizedrag:function(u,d,r,t){this.elBox=Ext.fly(u.resizeTracker.proxy).getBox()},resize:function(x,r,t,u){var v=x.el.id;x.el.setBox(this.elBox);Ds.setModified();Ds.updateAbsInfo(Wb.get(v.substring(0,v.length-7)))}}};if(k){a.minWidth=k}if(b){a.maxWidth=b}if(s){a.minHeight=s}if(p){a.maxHeight=p}a.draggable={listeners:{drag:Ds.dragHandle,mousedown:Ds.dragMousedown}};return a},retModule:function(){var a=Ds.at();if(a&&a.saveUrl){Ds.createTab(a.modTitle,a.modId,a.iconCls)}},delayRun:function(a,b){if(!Ds.delayRn){Ds.delayRn=new Ext.util.DelayedTask(Ds.run)}Ds.delayRn.delay(102)},invoke:function(e,b,d){var a=Pt.open(moduleTab,"main?xwl="+e,"Run - "+b,d);moduleTab.setActiveTab(a);a.modTitle=b;a.modId=e;Pt.load(a,true)},run:function(){var e=Ds.at(),d,c;if(!e){Wb.warning("Please open a module to run.");return}function f(){if(e.saveUrl){Pt.load(e,true)}else{d=e.title;c=e.id.substring(2);moduleTab.setActiveTab(Pt.open(moduleTab,"main?xwl="+c,"Run - "+d,e.iconCls));e=Ds.at();e.modTitle=d;e.modId=c;Pt.load(e,true)}}Ds.completeEdit();if(e.isModified){Ds.saveModule(false,f)}else{f()}},findTab:function(b){var a=null;Ds.at().items.each(function(d){if(d.bindObj==b&&d.absPanel){a=d;return false}});return a},getWidth:function(b,c){var a;if(Ext.isEmpty(b.width)){a=c}else{a=parseInt(b.width,10)}return a},getHeight:function(b,c){var a;if(Ext.isEmpty(b.height)){a=c}else{a=parseInt(b.height,10)}return a},editAbsLayout:function(){var l=Ds.at(),a;if(!l||l.saveUrl){Wb.warning("Please open a module to edit.");return}a=l.getActiveTab();if(!a||a!==l.generalTab){Wb.warning("Please select a container control.");return}function d(){var m=8,o=8,n=[];i.eachChild(function(r){var q=r.get("properties");if(Ext.isEmpty(q.x)||Ext.isEmpty(q.y)){m+=40;if(m>c-80){m=8;o+=24}}n.push(Ds.getRendProp(r,m,o))});return n}var j,h=Ds.at(),f=h.propertyGrid,i=h.objectTree.selectObject,g=i.get("text"),b=i.get("properties"),e=Ds.findTab(i),k,c=Ds.getWidth(b,450);if(!Ext.isDefined(b.layout)){Wb.warning(Wb.format('"{0}" has no layout.',g));return}if(b.layout!="absolute"){f.setProperty("layout","absolute");Ds.setModified()}if(e){h.setActiveTab(e);return}h.add({bindObj:i,iconCls:"window_icon",title:g,closable:true,autoScroll:true,bodyStyle:"background-color:#787878",items:[{width:c,height:Ds.getHeight(b,300),layout:"absolute",xwlId:i.get("text"),resizable:{handles:"s e se",pinned:true,listeners:{resize:function(q,m,n,p){if(k.idEdit.getValue()==k.absPanel.xwlId){Ds.updateAbsInfo(null)}Ds.setModified()}}},plugins:[new Wb.ide.DragSelector()],xtype:"panel",bodyStyle:"background-image:url(webbuilder/images/app/dot.gif)",items:d(),bindNode:i,listeners:{render:function(m){k.absPanel=m;m.body.on("dblclick",function(q,r){if(Ext.EventObject.ctrlKey){return}var s,p=Ds.at();if(r.clientWidth!=5||r.clientHeight!=5){Ds.showGeneral();if(r==k.absPanel.body.dom){s=m.bindNode}else{s=Ds.findEl(m,r);if(s){s=s.bindNode}else{s=null}}if(s){p.objectTree.selectPath(s.getPath("text"),"text")}}});m.body.on("mousedown",function(n,p){Ds.moduleSeled=false;if(p.clientWidth!=5||p.clientHeight!=5){if(p==k.absPanel.body.dom){Ds.selectAll(m,false);Ds.updateAbsInfo(k.absPanel)}else{Ds.selectEl(m,p,n.shiftKey)}}k.hEdit.focus(false,false);k.hEdit.blur()})}}}],bbar:[{text:"id",xtype:"tbtext"},{xtype:"textfield",width:100,allowBlank:false,validator:Ds.idValidatorBd,listeners:{change:function(n,m){Ds.setItemVal(function(p){Ds.changeId(n.bindNode,n.getValue());if(p.xwlId){p.xwlId=m}else{p.setValue(m)}})},render:function(m){k.idEdit=m}}},{text:"text",xtype:"tbtext"},{xtype:"textfield",width:100,listeners:{change:function(n,m){Ds.setItemVal(function(p){p.setValue(m)})},render:function(m){k.textEdit=m}}},{text:"x",xtype:"tbtext"},{xtype:"numberfield",width:55,listeners:{change:function(n,m){Ds.setItemVal(function(p){Ext.fly(p.id+"-rzwrap").setLeft(m)})},render:function(m){k.xEdit=m}}},{text:"y",xtype:"tbtext"},{xtype:"numberfield",width:55,listeners:{change:function(n,m){Ds.setItemVal(function(p){Ext.fly(p.id+"-rzwrap").setTop(m)})},render:function(m){k.yEdit=m}}},{text:"w",xtype:"tbtext"},{xtype:"numberfield",minValue:0,width:55,listeners:{change:function(n,m){Ds.setItemVal(function(p){j=Ext.fly(p.id+"-rzwrap");if(j){j.setWidth(m)}p.setWidth(m)})},render:function(m){k.wEdit=m}}},{text:"h",xtype:"tbtext"},{xtype:"numberfield",minValue:0,width:55,listeners:{change:function(n,m){Ds.setItemVal(function(p){j=Ext.fly(p.id+"-rzwrap");if(j){j.setHeight(m)}p.setHeight(m)})},render:function(m){k.hEdit=m}}},{iconCls:"alignRight_icon",tooltip:"Right align label",xtype:"splitbutton",handler:function(n,m){Ds.setTextAlign("right")},menu:{xtype:"menu",plain:true,items:{xtype:"buttongroup",title:"Text alignment",columns:4,height:45,defaults:{xtype:"button",scale:"small"},items:[{iconCls:"alignLeft_icon",tooltip:"Left align label",width:28,handler:function(){Ds.setTextAlign("left")}},{iconCls:"alignCenter_icon",tooltip:"Center align label",width:28,handler:function(){Ds.setTextAlign("center")}},{iconCls:"alignRight_icon",tooltip:"Right align label",width:28,handler:function(){Ds.setTextAlign("right")}},{iconCls:"alignRightPin_icon",enableToggle:true,pressed:false,width:28,tooltip:"Toggle right align new label",toggleHandler:function(n,m){k.labelRight=m}}]}}},{iconCls:"align_icon",tooltip:"Align controls",menu:{xtype:"menu",plain:true,items:{xtype:"buttongroup",title:"Align controls",columns:4,height:93,defaults:{xtype:"button",scale:"large"},items:[{iconCls:"ide_h1",width:35,height:35,tooltip:"Align left edges",handler:function(){Ds.setAlign(1)}},{iconCls:"ide_h2",width:35,height:35,tooltip:"Align horizontal centers",handler:function(){Ds.setAlign(2)}},{iconCls:"ide_h3",width:35,height:35,tooltip:"Center horizontally in window",handler:function(){Ds.setAlign(3)}},{iconCls:"ide_h4",width:35,height:35,tooltip:"Align right edges",handler:function(){Ds.setAlign(4)}},{iconCls:"ide_v1",width:35,height:35,tooltip:"Align tops",handler:function(){Ds.setAlign(5)}},{iconCls:"ide_v2",width:35,height:35,tooltip:"Align vertical centers",handler:function(){Ds.setAlign(6)}},{iconCls:"ide_v3",width:35,height:35,tooltip:"Center vertically in window",handler:function(){Ds.setAlign(7)}},{iconCls:"ide_v4",width:35,height:35,tooltip:"Align bottoms",handler:function(){Ds.setAlign(8)}}]}}}],listeners:{destroy:function(m){Wb.closeNav(backBtn,forwardBtn,m)},render:function(m){k=m;m.commitChange=function(){Ds.setAbsLayout(m.absPanel)}}}});h.setActiveTab(k);Ds.setDDSupport(k.absPanel);Ds.selectAll(k.absPanel,false);k.on("activate",Ds.syncTree)},syncTree:function(s){Ds.moduleSeled=false;if(Ds.stopSync){return}var b=s.absPanel,e=b.bindNode,a=e.get("properties"),j,c=null,h=0,o=8,k=8,g,f,q=b.getWidth(),i,d;b.setIconCls(a.iconCls);b.setWidth(Ds.getWidth(a,450));b.setHeight(Ds.getHeight(a,300));b.xwlId=e.get("text");b.items.each(function(l){e=l.bindNode;mt=e.get("xwlMeta");a=e.get("properties");if(mt=="label"){l.inputEl.setStyle("text-align",a.align);l.fsSeted=!Wb.isEmpty(a.align)}if(mt=="image"){if(Wb.isEmpty(a.src)){j="webbuilder/images/null.gif"}else{j=a.src}l.inputEl.setStyle("background-image","url("+j+")")}if(l.xwlId){l.xwlId=a.id}if(l.hasText){l.setValue(a.text)}else{l.setValue(a.id)}if(Ext.isEmpty(a.x)||Ext.isEmpty(a.y)){o+=40;if(o>q-80){o=8;k+=24}}if(Ext.isEmpty(a.x)){g=o}else{g=parseInt(a.x,10)}if(Ext.isEmpty(a.y)){f=k}else{f=parseInt(a.y,10)}if(Ext.isEmpty(a.width)){i=e.get("xwlWidth");if(Ext.isEmpty(i)){i=100}else{i=parseInt(i,10)}}else{i=parseInt(a.width,10)}if(Ext.isEmpty(a.height)){d=e.get("xwlHeight");if(Ext.isEmpty(d)){d=100}else{d=parseInt(d,10)}}else{d=parseInt(a.height,10)}Ds.ssz(l,g,f,i,d);if(l.ideSel){if(c==null){c=l}h++}});Ds.updateAbsInfo(c,h)},setAbsLayout:function(f){var h=Ds.at().objectTree.selectObject,e=Ds.at().propertyGrid,d,b,c;function a(i,g){c=Ds.gxy(i);if(h==i.bindNode){if(g){e.setProperty("x",c[0]);e.setProperty("y",c[1])}e.setProperty("width",i.getWidth());e.setProperty("height",i.getHeight());if(i.xwlId){e.setProperty("id",i.xwlId);i.bindNode.set("text",i.xwlId);if(i.isLabel){b=i.inputEl.getStyle("text-align");if(!i.fsSeted){b=""}e.setProperty("align",b)}}else{e.setProperty("id",i.getValue());i.bindNode.set("text",i.getValue())}i.bindNode.commit();if(i.hasText){e.setProperty("text",i.getValue())}}else{d=i.bindNode.get("properties");if(g){d.x=c[0];d.y=c[1]}d.width=i.getWidth();d.height=i.getHeight();if(i.xwlId){d.id=i.xwlId;if(i.isLabel){b=i.inputEl.getStyle("text-align");if(!i.fsSeted){b=""}d.align=b}}else{d.id=i.getValue()}if(i.hasText){d.text=i.getValue()}}}a(f,false);f.items.each(function(g){a(g,true)})},setItemVal:function(c){if(Ds.stopSetProp){return}var a=true,d=Ds.pn();d.items.each(function(b){if(b.ideSel){Ds.stopRecChg=true;c(b);Ds.stopRecChg=false;a=false}});Ds.setModified();if(a){c(d)}},findObj:function(b,a){var c=null;b.items.each(function(d){if(d.bindNode==a){c=d;return false}});return c},delBdObj:function(f){Ds.at().items.each(function(d){if(d.bindObj==f){d.close()}});var b=f.parentNode,e,a;a=Ds.findTab(b);if(a){e=a.absPanel;if(e){var c=Ds.findObj(e,f);if(c){e.remove(c,true)}}}f.eachChild(function(d){Ds.delBdObj(d)})},commitSet:function(){if(Ds.isFolder==="property"){Ds.setModule()}else{Ds.newModule()}},delPdObj:function(b,e){var a=Ds.findTab(b),c;if(a){c=a.absPanel;c.items.each(function(d){if(d.xwlId==e||Ext.isEmpty(d.xwlId)&&d.getValue()==e){c.remove(d,true)}})}},removeChildren:function(){if(Ds.slModule()){Ds.delModule(false)}else{var e=Ds.at(),d=e.objectTree.selectObject,f=d.childNodes,b,a=f.length;for(b=a-1;b>=0;b--){Ds.delBdObj(f[b]);f[b].remove()}if(a>0){Ds.setModified()}}},removeNode:function(){var b=Ds.at(),a=b.objectTree.selectObject;if(a&&a.getDepth()>1){if(a.nextSibling){b.objectTree.view.select(a.nextSibling)}else{if(a.previousSibling){b.objectTree.view.select(a.previousSibling)}else{b.objectTree.view.select(a.parentNode)}}Ds.delBdObj(a);a.remove();Ds.setModified()}else{Wb.warning(Wb.format(Str.cannotDelete,a.get("text")))}},controlStoreLoad:function(){var a=controlTree,b=a.getRootNode().firstChild;a.view.select(b);b.expand()},moduleTreeConfig:function(){return{plugins:{pluginId:"ddPlug",ptype:"treeviewdragdrop",ddGroup:"modules"},listeners:{beforedrop:function(b,c,a,d){if(!Wb.getNode(b)||!Wb.getNode(c.item)){return false}Wb.saveNodePos(Wb.getNode(c.item));return Wb.getTree(c.item)==moduleTree},drop:Ds.saveModuleTree}}},controlTreeConfig:function(){return{plugins:{pluginId:"ddPlug",ptype:"treeviewdragdrop",ddGroup:"controlList",enableDrop:false}}},removeFmControl:function(){var c=Ds.at(),d=c.getActiveTab();var e=d.absPanel,a=false,f;c.setActiveTab(c.generalTab);e.items.each(function(b){if(b.ideSel){f=b.bindNode;Ds.delBdObj(b.bindNode);f.remove();a=true}});Ds.stopSync=true;Ds.at().setActiveTab(d);Ds.stopSync=false;if(a){Ds.updateAbsInfo(null);Ds.at().objectTree.view.select(e.bindNode);Ds.setModified()}},removeControl:function(){if(Ds.slModule()){Ds.delModule(true)}else{var a=Ds.at();if(a.getActiveTab()==a.generalTab){Ds.removeNode()}else{Ds.removeFmControl()}}},cloneNode:function(e){var b={};if(e.data.children){e.data.children=undefined}b.n=e.copy(Ds.getId());if(e.hasChildNodes()){var a=[];e.eachChild(function(c){a.push(Ds.cloneNode(c))});b.c=a}return b},copyNode:function(){var a=Ds.getSelNode();if(a){Ds.clipBoard=[Ds.cloneNode(a)]}},copyFmControl:function(){var d=Ds.pn(),c=[],a=false;Ds.at().getActiveTab().commitChange();d.items.each(function(b){if(b.ideSel){c.push(Ds.cloneNode(b.bindNode));a=true}});if(a){Ds.clipBoard=c}},copyControl:function(){if(Ds.slModule()){Ds.copyModule(false)}else{var a=Ds.at().getActiveTab();if(a==Ds.at().generalTab){Ds.copyNode()}else{Ds.copyFmControl()}}},cutNode:function(){Ds.copyControl();Ds.removeControl()},cutFmControl:function(){Ds.copyFmControl();Ds.removeFmControl()},slModule:function(){var a=Ds.at();return Ds.moduleSeled||a&&(a.saveUrl||a&&a.getActiveTab()&&a.getActiveTab().isScriptEdt)||moduleTab.items.length==0},cutControl:function(){if(Ds.slModule()){Ds.cutModule()}else{var a=Ds.at().getActiveTab();if(a==Ds.at().generalTab){Ds.cutNode()}else{Ds.cutFmControl()}}},appendNode:function(c,h,a){var k,e,g,f;if(a){e=h.n.copy(Ds.getId());k=c.appendChild(e)}else{k=c}Ds.renameNode(k);if(h.c){f=h.c.length;for(g=0;g<f;g++){Ds.appendNode(k,h.c[g],true)}}},pasteNode:function(w){var d,f=Ds.getSelNode();if(f==null||Ds.clipBoard==null){return}var b=f.parentNode,x=f.nextSibling,o,k=0,h=Ds.clipBoard.length,q=null,e,m=null,v,l,a,u;if(f.getDepth()==1){d=true}else{d=w}if(Ds.clipBoard[0].n.get("xwlMeta")=="module"){v=Ds.at();l=v.generalTab;v.items.each(function(g){if(g!=l){g.close()}});a=v.objectTree.getRootNode();a.firstChild.remove();f=a;d=true}else{if(d){e=f}else{e=b}if(!Ds.canDroped(Ds.clipBoard[0].n,e,true)){d=true;e=f;if(!Ds.canDroped(Ds.clipBoard[0].n,e,true)){Wb.warning(Str.cannotAppend);return}}}for(k=0;k<h;k++){o=Ds.clipBoard[k].n.copy(Ds.getId());if(d){o=f.appendChild(o)}else{if(!x){o=b.appendChild(o)}else{o=b.insertBefore(o,x)}}m=Ds.findTab(o.parentNode);if(q==null){q=o}Ds.appendNode(o,Ds.clipBoard[k],false);if(m){u=m.absPanel.add(Ds.getRendProp(o,8,8,o.get("text")));Ds.selectObj(u,false)}}if(q){q.parentNode.expand();Ds.at().objectTree.view.select(q)}Ds.setModified()},pasteFmControl:function(){if(Ds.clipBoard==null){return}var b=Ds.pn(),e=b.bindNode,h=0,g=Ds.clipBoard.length,o,r=8,q=8,k=[],m,a=b.getWidth(),l,f;if(!Ds.canDroped(Ds.clipBoard[0].n,e,true)){Wb.warning(Str.cannotAppend);return}for(h=0;h<g;h++){o=Ds.clipBoard[h].n.copy(Ds.getId());o=e.appendChild(o);Ds.appendNode(o,Ds.clipBoard[h],false);m=o.get("properties");if(Ext.isEmpty(m.x)||Ext.isEmpty(m.y)){r+=40;if(r>a-80){r=8;q+=24}}f=Ds.getRendProp(o,r,q,o.get("text"));f.newPaste=true;k.push(f)}b.add(k);Ds.selectAll(b,false);l=null;b.items.each(function(c){if(c.newPaste){c.newPaste=false;if(l==null){l=c}Ds.selectObj(c,true)}});Ds.updateAbsInfo(l,g);Ds.setModified()},pasteControl:function(c){var b=Ext.EventObject.shiftKey||c;if(Ds.slModule()){Ds.pasteModule(b)}else{var a=Ds.at().getActiveTab();if(a==Ds.at().generalTab){Ds.pasteNode(b)}else{Ds.pasteFmControl()}}},restoreIcon:function(){var b,a=Ds.iconList.length,c;for(b=0;b<a;b++){c=Ds.iconList[b];Ds.iconList[b]=[c+"_icon",c+"_icon",c]}},setDisplay:function(c){var a=c.get("xwlCategory");if(Wb.indexOf(a,"labelComp")!=-1){var b=c.get("properties");b.text=c.get("text");if(c.get("xwlMeta")=="label"&&Ds.at().getActiveTab().labelRight){b.align="right"}}},addNode:function(c){var b=Ds.getSelNode(),h;if(b==null){return}var a=b.parentNode,j=b.nextSibling,e,g,f,d=null;g=!Ext.EventObject.ctrlKey&&Ds.canDroped(c,a,true);f=Ds.canDroped(c,b,true);if(!g&&!f){Wb.warning(Str.cannotAppend);return}h=c.copy(Ds.getId());if(g){if(j){e=a.insertBefore(h,j)}else{e=a.appendChild(h)}d=Ds.findTab(a)}else{e=b.appendChild(h);d=Ds.findTab(b)}Ds.renameNode(e,true);Ds.setDisplay(e);if(d){var i=d.absPanel.add(Ds.getRendProp(e,8,8,e.get("text")));Ds.selectObj(i,false)}e.parentNode.expand();Ds.at().objectTree.view.select(e);Ds.setModified()},addFmControl:function(d){var b=Ds.pn();if(!Ds.canDroped(d,b.bindNode,true)){Wb.warning(Str.cannotAppend);return}var a=d.copy(Ds.getId()),c=b.bindNode.appendChild(a),f,e;Ds.renameNode(c,true);Ds.setDisplay(c);f=c.get("text");Ds.selectAll(b,false);e=b.add(Ds.getRendProp(c,16,16,f));e.ideSel=true;Ds.updateAbsInfo(e);Ds.setModified()},addControl:function(b){var a=Ds.at();if(!a||a.saveUrl){return}a=a.getActiveTab();if(a==Ds.at().generalTab){Ds.addNode(b)}else{if(a.absPanel){Ds.addFmControl(b)}}},setDDSupport:function(a){new Ext.dd.DropTarget(a.body.dom,{ddGroup:"controlList",notifyDrop:function(f,g,d){if(!Ds.canDroped(d.records[0],a.bindNode,true)){Wb.warning(Str.cannotAppend);return}Ds.selectAll(a,false);var j=g.getX()-a.body.getLeft(),i=g.getY()-a.body.getTop(),k=d.records[0],h=k.copy(Ds.getId()),b,c=Ds.at().getActiveTab().bindObj.appendChild(h);Ds.renameNode(c,true);Ds.setDisplay(c);b=a.add(Ds.getRendProp(c,Ds.getSnap(j),Ds.getSnap(i),c.get("text")));b.ideSel=true;Ds.updateAbsInfo(b);Ds.setModified();return true}})},defDragSel:function(){Ext.define("Wb.ide.DragSelector",{requires:["Ext.dd.DragTracker","Ext.util.Region"],init:function(a){this.panel=a;a.mon(a,{beforecontainerclick:this.cancelClick,scope:this,render:{fn:this.onRender,scope:this,single:true}})},onRender:function(){this.tracker=new Ext.dd.DragTracker({panel:this.panel,el:this.panel.body,dragSelector:this,onBeforeStart:this.onBeforeStart,onStart:this.onStart,onDrag:this.onDrag,onEnd:this.onEnd});this.dragRegion=new Ext.util.Region()},onBeforeStart:function(a){return a.target==this.panel.body.dom},onStart:function(a){var b=this.dragSelector;this.dragging=true;b.fillRegions();b.getProxy().show()},cancelClick:function(){return !this.tracker.dragging},onDrag:function(h){var b=this.dragSelector,n=b.dragRegion,m=b.bodyRegion,k=b.getProxy(),j=this.startXY,p=this.getXY(),d=Math.min(j[0],p[0]),c=Math.min(j[1],p[1]),a=Math.abs(j[0]-p[0]),o=Math.abs(j[1]-p[1]),l,f;Ext.apply(n,{top:c,left:d,right:d+a,bottom:c+o});n.constrainTo(m);k.setRegion(n);var i=null,g=0;this.panel.items.each(function(e){l=e.el.getRegion();f=n.intersect(l);Ds.selectObj(e,f);if(f){i=e;g++}});Ds.updateAbsInfo(i,g)},onEnd:Ext.Function.createDelayed(function(a){var b=this.dragSelector;this.dragging=false;b.getProxy().hide()},1),getProxy:function(){if(!this.proxy){this.proxy=this.panel.body.createChild({tag:"div",cls:"x-view-selector"})}return this.proxy},fillRegions:function(){var a=this.panel;this.bodyRegion=a.body.getRegion()}})},initialize:function(){Ds.defDragSel();Ds.defColorPicker();Ds.modifyExt();Wd.WBXwlPrint=Ds.print},print:function(a){Ds.consoleRaws.push(Ds.consoleIdx);Ext.DomHelper.insertHtml("beforeEnd",consolePanel.body.dom,'<span id="xln'+(Ds.consoleIdx++)+'">'+Wb.toHtml(""+a)+"</span>");if(Ds.consoleRaws.length>200){Ext.fly("xln"+Ds.consoleRaws[0]).remove();Ds.consoleRaws.splice(0,1)}consolePanel.body.dom.scrollTop=consolePanel.body.dom.scrollHeight},hideView:function(){Ds.stopConsole();viewTab.hide()},showView:function(a){viewTab.show();if(a!==null){viewTab.setActiveTab(a)}if(viewTab.getActiveTab()==consolePanel){Ds.startConsole()}},stopConsole:function(){if(Ds.consoleTime!==null){clearInterval(Ds.consoleTimer);Ds.consoleTimer=null}},startConsole:function(){if(Ds.consoleTimer==null){Ds.consoleTimer=setInterval(function(){if(!Ds.consolePaused){Ds.queryConsole()}},2000)}},clearConsole:function(){var e=Ds.consoleRaws,b,a=e.length,d;for(b=a-1;b>=0;b--){d=Ext.fly("xln"+e[b]);if(d){d.remove()}}e.splice(0,a)},queryConsole:function(){if(Ds.reqConsole){return false}Ds.reqConsole=true;Ext.Ajax.request({url:"main?xwl=13MMOY5MGR78",timeout:10000,callback:function(){Ds.reqConsole=false},success:function(d){var b=0,a,c=d.responseText;if(Wb.isEmpty(c)){return}a=c.length;while(b<a){Ds.print(c.substring(b,b+200));b+=200}}})},modifyExt:function(){Ds.saveComboQuery=Ext.form.field.ComboBox.prototype.doRawQuery;Ext.form.field.ComboBox.prototype.doRawQuery=function(){var a=String.fromCharCode(Ds.keyCode);if(Ds.ctrlKey&&(a=="S"||a=="Q")){return}Ds.saveComboQuery.call(this)};Ds.saveComboGV=Ext.form.field.ComboBox.prototype.getValue;Ext.form.field.ComboBox.prototype.getValue=function(){var a=Ds.saveComboGV.call(this);if(Ext.isArray(a)){a=a.join(",")}return a||""};Ext.override(Ext.grid.plugin.CellEditing,{cancelEdit:function(){var c=this,b=c.getActiveEditor(),a=c.grid.getView().getEl(c.getActiveColumn());if(b&&b.field.lastQuery!==b.field.lastValue){b.field.fireEvent("change",b.field)}c.setActiveEditor(null);c.setActiveColumn(null);c.setActiveRecord(null);if(b){b.cancelEdit();a.focus();c.callParent(arguments)}}})},selectAll:function(d,a){var e=null,c=0;d.items.each(function(b){if(e==null){e=b}c++;Ds.selectObj(b,a)});if(a){Ds.updateAbsInfo(e,c)}else{Ds.updateAbsInfo(null)}},findEl:function(b,a){var c=null;b.items.each(function(d){if(d.el.dom==a||d.inputEl&&d.inputEl.dom==a){c=d;return false}});return c},selectEl:function(g,f,a){var h=Ds.findEl(g,f),c=0,d=true;if(h==null){return}if(a){Ds.selectObj(h,!h.ideSel);d=false}else{if(h.ideSel){d=false}}g.items.each(function(b){if(d){Ds.selectObj(b,b.el.dom==f||b.inputEl&&b.inputEl.dom==f)}if(b.ideSel){c++}});Ds.updateAbsInfo(h,c)},pn:function(){return Ds.at().getActiveTab().absPanel},updateAbsInfo:function(e,a){Ds.stopSetProp=true;var f,d,c=Ds.at().getActiveTab(),b;if(Ext.isEmpty(a)){d=1}else{d=a}if(e==null&&d==1||d==0){f=Ds.pn();d=1}else{f=e}c.idEdit.setDisabled(d>1);if(f==null||d!=1){if(d>1){c.idEdit.setValue("("+d+" items)")}else{c.idEdit.setValue("")}c.textEdit.setValue("");c.textEdit.setDisabled(true);c.xEdit.setDisabled(false);c.yEdit.setDisabled(false);c.xEdit.setValue("");c.yEdit.setValue("");c.wEdit.setValue("");c.hEdit.setValue("")}else{c.idEdit.bindNode=f.bindNode;if(f.xwlId){c.idEdit.setValue(f.xwlId)}else{c.idEdit.setValue(f.getValue())}c.textEdit.setDisabled(!f.hasText);if(!f.hasText){c.textEdit.setValue("")}if(f.hasText){c.textEdit.setValue(f.getValue())}b=Ds.gxy(f);c.xEdit.setValue(b[0]);c.yEdit.setValue(b[1]);c.xEdit.setDisabled(f==c.absPanel);c.yEdit.setDisabled(f==c.absPanel);c.wEdit.setValue(f.width);c.hEdit.setValue(f.height)}Ds.stopSetProp=false},selectObj:function(i,a){if(i.ideSel!=null&&i.ideSel==a){return}var e=i.resizer;if(e){var f=e.possiblePositions,h;i.ideSel=a;for(h in f){var g=e[f[h]];if(g){a?g.show():g.hide()}}}},defColorPicker:function(){Ext.define("Wb.ide.ColorField",{extend:"Ext.form.field.Picker",requires:["Ext.picker.Color"],matchFieldWidth:false,initComponent:function(){var a=this;a.callParent()},getErrors:function(a){return[]},createPicker:function(){var a=this;a.picker=new Ext.picker.Color({ownerCt:a.ownerCt,renderTo:document.body,floating:true,hidden:true,focusOnShow:true,listeners:{scope:a,select:a.onSelect},keyNavConfig:{esc:function(){a.collapse()}}});return a.picker},onSelect:function(a,c){var b=this;b.setValue("#"+c);b.collapse()},onExpand:function(){var b=this,a=b.getValue();if(!Ext.isEmpty(a)&&a.substring(0,1)=="#"){a=a.substring(1);if(Wb.indexOf(b.picker.colors,a)!=-1){b.picker.select(a,true)}}},onCollapse:function(){this.focus(false,60)},beforeBlur:function(){var c=this,a=c.getValue(),b=c.focusTask;if(b){b.cancel()}if(a){c.setValue(a)}}})},setAlign:function(f){var m,k,s,o=Ds.pn(),e,c,x,t=null,r=null,n=null,g=o.getWidth(),d,y=false,b,j,i,q=null,a=null,v=null,l=o.getHeight()-(o.header?o.header.getHeight():0);o.items.each(function(h){if(h.ideSel){m=Ds.gxy(h);k=h.getWidth();s=h.getHeight();e=m[0];if(t===null||e<t){t=e}c=m[0]+k;if(r===null||c>r){r=c}x=k;if(n===null||x>n){n=x}b=m[1];if(q===null||b<q){q=b}j=m[1]+s;if(a===null||j>a){a=j}i=s;if(v===null||i>v){v=i}}});d=(g-r+t)/2-t;offH=(l-a+q)/2-q;o.items.each(function(h){if(h.ideSel){y=true;m=Ext.fly(h.id+"-rzwrap");k=Ds.gxy(h);switch(f){case 1:m.setLeft(t);break;case 2:m.setLeft(t+(n-h.getWidth())/2);break;case 3:m.setLeft(k[0]+d);break;case 4:m.setLeft(r-h.getWidth());break;case 5:m.setTop(q);break;case 6:m.setTop(q+(v-h.getHeight())/2);break;case 7:m.setTop(k[1]+offH);break;case 8:m.setTop(a-h.getHeight());break}}});if(y){Ds.setModified()}},setTextAlign:function(c){var b=Ds.pn(),a=false;b.items.each(function(d){if(d.ideSel&&d.isLabel){d.inputEl.setStyle("text-align",c);d.fsSeted=true;a=true}});if(a){Ds.setModified()}},cutModule:function(){Ds.copyModule(true)},copyModule:function(b){Ds.isCut=b;var a=moduleTree.selectModule;Ds.copiedModule=a},pasteModule:function(f){var d=moduleTree;if(d.pasting){return}if(!Ds.copiedModule||!d.view.getNode(Ds.copiedModule)){Wb.warning("Source module does not exist.");return}var c,b=Ds.copiedModule.copy(Ds.getId()),a=d.selectModule,e;if(a.get("IS_FOLDER")){if(Ds.isCut){f=true}}else{f=false}if(f){e=a}else{e=a.parentNode}c=e;while(c){if(c==Ds.copiedModule){Wb.warning("The destination folder is a subfolder of the source folder.");return}c=c.parentNode}e.expand(false,function(){var g=e.lastChild?e.lastChild.get("ORDER_INDEX")+1:1;d.pasting=true;Wb.request({url:"main?xwl=13L88K98GZOG",mask:d,params:{isCut:Ds.isCut,id:b.get("MODULE_ID"),parentId:e.getDepth()==0?-1:e.get("MODULE_ID"),orderIndex:g},callback:function(){d.pasting=false},success:function(i){var h=Ext.decode(i.responseText);b.set("loaded",false);if(!Ds.isCut){b.set("MODULE_ID",h.id);b.set("CREATE_DATE",h.date);b.set("LAST_MODIFY_DATE",h.date);b.set("CREATE_USER",h.user);b.set("LAST_MODIFY_USER",h.user)}b.set("ORDER_INDEX",g);b.commit();var j=e.appendChild(b);d.view.select(j);if(Ds.isCut){Ds.copiedModule.remove();Ds.copiedModule=null}}})})},dropUrl:function(a){new Ext.dd.DropTarget(a.body.dom,{ddGroup:"modules",notifyDrop:function(o,h,i){var k=a.view,m=k.cellSelector,j=h.getTarget(m.cellSelector),g,b,f;if(j){g=k.findItemByChild(j),b=i.records[0],f=k.getRecord(g).get("name");if(Wb.getNamePart(Ds.at().objectTree.selectObject.get("xwlPT")[f]).substring(0,3)=="url"&&!b.get("IS_FOLDER")){a.setProperty(f,"#"+b.get("MODULE_ID")+" ("+b.get("orgText")+")");Ds.setModified()}}}})}};